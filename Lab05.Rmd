---
title: "Lab 05 - Wrangling spatial data"
author: "Allison Li"
date: "02/09/2025"
output: 
  html_document: 
    toc: yes
    toc_float: yes
---

```{r load-pkg, message = FALSE}
##devtools::install_github("rstudio-education/dsbox")
library(tidyverse)
library(dsbox)
```

### Exercise 1
```{r filtered AK data}
dn_ak <- dennys %>%
  filter(state == "AK")
nrow(dn_ak)

lq_ak <- laquinta %>%
  filter(state == "AK")
nrow(dn_ak)
```

There are `r nrow(dn_ak)` Denny's stores in Alaska and `r nrow(lq_ak)` La Quinta hotels in Alaska.

### Exercise 2

```{r}
pairings_of_lqak <- nrow(dn_ak) * nrow(lq_ak)
cat("The number of pairings between the locations of Denny’s and La Quinta hotels in Alaska are:", pairings_of_lqak, "\n")
```
I asked ChatGPT to help me generate this code because I was not sure what could be the correct function for this.

### Exercise 3

```{r load-data, message = FALSE}

dn_lq_ak <- full_join(dn_ak, lq_ak, 
                      by = "state")
dn_lq_ak
```

### Exercise 4

There are `r ncol(dn_lq_ak)` observations in the joined data frame. The names including city.x, zip.x, longitude.x, latitude.x, address.x, which all refer to the locations of the Denny's. The names of the rest variables, including city.y, zip.y, longitude.y, latitude.y, address.y all refer to the locations of the La Quinta hotels. 

### Exercise 5
```{r haversine}
haversine <- function(long1, lat1, long2, lat2, round = 3) {
  # convert to radians
  long1 <- long1 * pi / 180
  lat1 <- lat1 * pi / 180
  long2 <- long2 * pi / 180
  lat2 <- lat2 * pi / 180

  R <- 6371 # Earth mean radius in km

  a <- sin((lat2 - lat1) / 2)^2 + cos(lat1) * cos(lat2) * sin((long2 - long1) / 2)^2
  d <- R * 2 * asin(sqrt(a))

  return(round(d, round)) # distance in km
}
```

To answer the question of what function to use from the tidyverse to add a new variable while keeping the existing ones, I believe we can use mutate().

### Exercise 6
```{r distance between all pairs}

dn_lq_ak <- dn_lq_ak %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y))

print(dn_lq_ak)
```

### Exercise 7

```{r minimum distance}

dn_lq_ak_mindist <- dn_lq_ak %>%
  group_by(address.x) %>%
  mutate(closest = min(distance))

print(dn_lq_ak_mindist)
```

### Exercise 8

```{r report and visualization}
## Mean 
mean_closestdist <- mean(dn_lq_ak_mindist$closest) 
## Standard deviation 
sd_closestdist <- sd(dn_lq_ak_mindist$closest) 

## I want to merge the two dataset so that I can have a set including five stores and their location information, as well as which ones are La Quinta and which ones are Denny's.
dn_ak <- dn_ak %>% mutate(source = "Denny's")
lq_ak <- lq_ak %>% mutate(source = "La Quinta")
merged_data_ak <- bind_rows(dn_ak, lq_ak)

## The section block below is helped by ChatGPT. I asked it how to generate a dataset with only the three minimum distances and their longitude, latitude, and other variables of Denny's and La Quinta hotels accordingly.
dn_lq_ak_minidis <- dn_lq_ak %>%
  group_by(address.x) %>%
  filter(distance == min(distance)) %>% 
  ungroup()

## I want the visualized plot to be able to show the shortest distances between each Denny's and La Quinta hotel. 
ggplot(merged_data_ak, aes(x = longitude, y = latitude, color = source)) +
  geom_point(size = 3, alpha = 0.8) + 
  geom_segment(data = dn_lq_ak_minidis,
               aes(x = longitude.x, y = latitude.x, 
                   xend = longitude.y, yend = latitude.y), 
               color ="purple", linetype = "solid", size = .8)
  labs(title = "Scatter Plot of Denny's and La Quinta",
       x = "Longitude",
       y = "Latitude",
       color = "Dataset")

```

The three minimum distance between the Denny's and La Quinta hotels are `r round(sort(dn_lq_ak_mindist$closest)[1], 2)`, `r round(sort(dn_lq_ak_mindist$closest)[2], 2)`, and `r round(sort(dn_lq_ak_mindist$closest)[3], 2)` separately. The mean for the minimum distances is `r round(mean_closestdist, 2)` while the standard deviation is `r round(sd_closestdist, 2)`.

In terms of visiualization, with the help of Chatgpt, I am able to add the purple lines that demostrate the minimum distances between Denny's and La Quinta hotels, yay!

### Exercise 9.1
```{r filtered NC data}
dn_nc <- dennys %>%
  filter(state == "NC")
nrow(dn_nc)

lq_nc <- laquinta %>%
  filter(state == "NC")
nrow(dn_nc)
```
### Exercise 9.2
```{r all possible pairings}
pairings_of_lqnc <- nrow(dn_nc) * nrow(lq_nc)
cat("The number of pairings between the locations of Denny’s and La Quinta hotels in Alaska are:", pairings_of_lqnc, "\n")
```
### Exercise 9.3
```{r all the distance between in NC}
dn_lq_nc <- full_join(dn_nc, lq_nc, 
                      by = "state")
dn_lq_nc

dn_lq_nc <- dn_lq_nc %>%
  mutate(distance = haversine(longitude.x, latitude.x, longitude.y, latitude.y))

print(dn_lq_nc)
```
### Exercise 9.4
```{r minimum distances in NC}
dn_lq_nc_minidis <- dn_lq_nc %>%
  group_by(address.x) %>%
  summarize(closest = min(distance))
print(dn_lq_nc_minidis)
```


### Exercise 10.1

### Exercise 10.2

### Exercise 10.3

### Exercise 10.4
### Exercise 10.5

### Exercise 11


### Exercise 12